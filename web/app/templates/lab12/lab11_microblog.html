<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="static/css/open-iconic-bootstrap.css">

    <link rel="stylesheet" href="static/css/mytwitter.css">
    <title>My Twitter</title>
</head>

<body>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>

<body>
    <nav class="navbar navbar-expand-md navbar-light">
        <div class="container">
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="#"><span class="oi oi-home"></span> Home</a>
                <a class="nav-item nav-link" href="#"><span class="oi oi-bolt"></span> Moments</a>
                <a class="nav-item nav-link" href="#"><span class="oi oi-bell"></span> Notifications</a>
                <a class="nav-item nav-link" href="#"><span class="oi oi-envelope-open"></span> Messages</a>
            </div>

            <img class="tw-logo" src="static/img/twitterlogo.png"> &nbsp;
            <form class="form-inline">
                <input class="form-control" id="nav-search" type="search" placeholder="Search Twitter"> &nbsp;
                <img class="tw-user-small rounded-circle" src="static/img/profile-picture.png"> &nbsp;

                <button class="btn" id="nav-tweet-btn" type="submit">Tweet</button>
            </form>
        </div>
    </nav>
    <div class="container">

        <div class="row">

            <div id="left_3" class="col-md-3">
                <div class="profile">
                    <a class="profile-bg d-block">
                    </a>
                    <div>
                        <a href="#" class="profile-link">
                            <img src="static/img/profile-picture.png"
                                class="tw-user-small1 rounded-circle mx-auto d-block">
                        </a>
                        <div class="profile-marg">
                            <div class="profile-name">
                                <a href="#" class="name">Kaemsai Prarisa</a>
                            </div>
                            <span>
                                <a href="#" class="name">@<span>ksprarisa</span></a>
                            </span>
                        </div>
                        <div class="profile-state">
                            <ul class="profile-arrange">
                                <li class="profile-details">
                                    <a href="#">
                                        <span class="profile-label d-block">Tweets</span>
                                        <span class="profile-number">10</span>
                                    </a>
                                </li>
                                <li class="profile-details">
                                    <a href="#">
                                        <span class="profile-label d-block">Following</span>
                                        <span class="profile-number">256</span>
                                    </a>
                                </li>
                                <li class="profile-details">
                                    <a href="#">
                                        <span class="profile-label d-block">Followers</span>
                                        <span class="profile-number">327</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="content-box">

                    <ul class="change">
                        <li class="trend-country">United Kingdom trends</li>
                        <li class="c">Change</li>
                    </ul>
                    <div class="trends-marg">
                        <div class="trends-name">
                            <a href="#" class="t">#NationalPizzaDay</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>18.5K Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">#FridayFeeling</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>@smwsTheVaults is Tweeting about this</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">#WinterOlympics</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>Team GB are ready for the Winter Olympics</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">#TwitchRecap</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>10.2K Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">Michael Barnier</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>8,977 Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">#WeishLanguageMusicDay</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>6,345 Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">#WednesdayMotivation</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>3,029K Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">London-Amsterdam</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>1,222 Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">Argentina</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>91.5K Tweets</span></a>
                        </span>
                        <div class="trends-name">
                            <a href="#" class="t">Trinity Mirror</a>
                        </div>
                        <span>
                            <a href="#" class="t1"><span>2,836 Tweets</span></a>
                        </span>
                    </div>
                </div>
            </div>

            <div id="center_6" class="col-md-6">
                <div class="content-box">
                    <div class="new-tweet-row">
                        <div class="row">
                            <div class="col-md-2">
                                <img src="static/img/profile-picture.png"
                                    class="tw-user-small rounded-circle mx-auto d-block">
                            </div>
                            <div class="col-md-9">

                                <form id="addNewTweet" hidden="hidden">
                                    <h3 class="tweets" id="add-tweet">Add new tweet</h3>
                                    <label for="name">Name</label>
                                    <input type="text" id="name" name="name" placeholder="Your name..." required>
                                    <label for="message">Message</label>
                                    <textarea id="message" name="message" placeholder="Type your message..."
                                        required></textarea>
                                    <label for="email">Email</label>
                                    <input type="email" id="mail" name="email" placeholder="Your email..." required>
                                    <input type="hidden" id="entryid" name="id" value="">
                                    <input type="submit" id="submit" name="submit" value="Tweet">
                                    <button id="clear" type="button">Clear</button>
                                    <button id="cancel" type="button">Cancel</button>
                                </form>
                                <button id="new-tweet" type="button">+ Tweet</button>
                            </div>
                        </div>
                    </div>
                    &nbsp;
                    <div class="contentbox-box" id="demo">

                    </div>

                </div>
            </div>

            <div id="right_3" class="col-md-3">
                <div class="content-box">
                    <p class="follow1">Who to follow</p>
                    <div class="box"><img class="tw-user-small2 rounded-circle" src="static/img/camela.png"
                            align="left" />
                        <p id="text">Camelaa_123</p>
                    </div>
                    <div class="box"><img class="tw-user-small2 rounded-circle" src="static/img/sailor-moon.jpeg"
                            align="left" />
                        <p id="text">PungPung</p>
                    </div>
                    <div class="box"><img class="tw-user-small2 rounded-circle" src="static/img/book.jpg"
                            align="left" />
                        <p id="text">BookforFunn</p>
                    </div>
                    <div class="box"><img class="tw-user-small2 rounded-circle" src="static/img/dogcute.jpg"
                            align="left" />
                        <p id="text">Dogsocute</p>
                    </div>
                </div>
            </div>
        </div>
</body>


</nav>
<!-- Optional JavaScript -->
<script>

    function populate_post(contact_data) {
        console.log(contact_data);

        let output = ``
        contact_data.forEach(element => {
            console.log(element)
            console.log(element)
            console.log(element.id)

            var date = new Date();
            var offset = date.getTimezoneOffset();
            const db_date = new Date((Date.parse(element.date_created) - (offset * 60 * 1000))).toLocaleString("th-TH")
            var id = element.id
            output = `
            <div class="tweet">
                <div class="row">
                    <div class="col-md-2 text-center">
                        <img class="tw-user-medium rounded-circle" src="static/img/profile-picture.png">
                    </div>

                    <div class="col-md-10">
                        <div class="row tweet-info">
                            <div class="col-md-auto">
                                <span class="tweet-username" id="username${id}">${element.name}</span>
                                <span class="tweet-email" id="e_mail${id}">${element.email}</span>-
                                <span class="tweet-age text-muted">${db_date}</span>
                                <span class="tweet-id" hidden="hidden"></span>
                            </div>
                        </div>

                        <div class="tweet-text" id="messages${id}">
                            ${element.message}
                        </div>
                        <div class="row text-muted">
                            
                            <button id="retweet" type="button"><span class="oi oi-loop-circular"></span></botton>
                            <button id="like" type="button">❤️</button>
                            <button id="edit" type="button" onclick="prePopulateForm(${element.id})">✏️</button>
                            <button id="remove" type="button" onclick="removeItem(${element.id})">🗑️</button>
                            
                            
                        </div>
                        
                    </div>

                </div>
            </div>
            ` + output;

        });
        document.getElementById("demo").innerHTML = output;

    }

    $(document).ready(function () {
        (function () {
            $.getJSON("lab11/blog", populate_post);
        })();
    });


    $("#addNewTweet").submit(function (event) {
        // prevent default html form submission action
        event.preventDefault();


        // pack the inputs into a dictionary
        var formData = {};
        $("#addNewTweet :input").each(function () {
            var key = $(this).attr('name');
            var val = $(this).val();


            if (key != 'submit') {
                formData[key] = val;
            }
        });


        var $form = $(this);
        var url = $form.attr("action");


        // make a POST call to the back end w/ a callback to refresh the table
        $.post(url, formData, function (contact_data) {
            //refresh_table(contact_data);
            populate_post(contact_data);
            clearFormNew()
        });
        toggleView()
    });

    function toggleView() {
        if ($('#addNewTweet').attr('hidden')) {
            $('#addNewTweet').removeAttr('hidden');
            $('#new-tweet').attr('hidden', 'hidden');
        } else {
            $('#addNewTweet').attr('hidden', 'hidden');
            $('#new-tweet').removeAttr('hidden');
        }
    }
    function clearForm() {
        $('#addNewTweet')[0].reset();
        $('#entryid').val('');
    }
    function clearFormNew() {
        $('#message').val('');
        $('#entryid').val('');
    }

    $("#new-tweet").click(function () {
        clearFormNew();
        toggleView();
    });
    $("#clear").click(function () {
        clearForm();
    });

    $("#cancel").click(function () {
        clearFormNew();
        toggleView();
    });




    function prePopulateForm(id) {
        console.log(id)
        $('#addNewTweet')[0].reset();
        $('#name').val(document.getElementById("username" + id).innerHTML);
        $('#message').val(document.getElementById("messages" + id).innerHTML);
        $('#mail').val(document.getElementById("e_mail" + id).innerHTML);
        $('#entryid').val(id);
        console.log(id)

        toggleView();

    }
    function removeItem(id) {

        if (!confirm("Delete " + '?')) {
            return false;
        }
        var url = "/lab11/remove_blog"
        var formData = { 'id': id };
        $.post(url, formData, function (contact_data) {
            populate_post(contact_data);
        });
    }



</script>


</html>